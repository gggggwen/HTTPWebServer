## Threadpool 线程池

- 线程池管理所有工作线程生命周期, 提供工作队列,来实现与主线程数据传递

- 采用信号量, 互斥锁实现与主线程间以及工作线程之间的同步

- 工作线程仅负责处理业务逻辑(应用层)

### 1.`std::list<std::shared_ptr<T> > m_jobqueue`  

在此队列下 ,线程池中的工作线程为消费者 , 主线程为生产者

- **保证线程安全**

```c++
Semaphore m_queuesem ; //信号量, 当主线程将任务分发到队列中将会通知工作线程
Mutexlock m_queuelock ;
```

- **外部接口**

```c++
   bool append(std::shared_ptr<T> &job); //在请求队列中追加http_conn类 由主线程使用
```

此函数线程安全, 内部会有加锁操作, 且当任务成功追加至工作队列中后, 将通知工作线程



### 2.`std::list<std::shared_ptr<T> > m_dead_users ;`

在此队列下 ,线程池中的工作线程为生产者 , 主线程为消费者

在处理过程中会存在业务逻辑处理异常的情况, 有时候非常严重需要直接关闭套接字, 此时不再需要发送响应报文

但是线程池不能直接操作套接字,这是我的原则**, 即套接字生命周期只能让主线程进行管理,**所以采用了列表形式来暂存将关闭连接的用户。

**主线程将在每一次tick,之后集中处理线程池中的濒死用户**